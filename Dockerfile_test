FROM yourls:latest

WORKDIR /usr/src/yourls

RUN rm -rf /usr/src/yourls/user/plugins/random-bg

RUN rm -rf /usr/src/yourls/user/plugins/random-shorturls

RUN rm -rf /usr/src/yourls/user/plugins/sample-page

RUN rm -rf /usr/src/yourls/user/plugins/sample-plugin

RUN rm -rf /usr/src/yourls/user/plugins/sample-toolbar

ADD https://github.com/adigitalife/yourls-case-insensitive/tarball/master     \
    /opt/yourls-case-insensitive.tar.gz    

RUN for i in $(ls /opt/*.tar.gz); do                                          \
      plugin_name="$(basename ${i} '.tar.gz')"                              ; \
      mkdir -p user/plugins/${plugin_name}                                  ; \
      tar zxvf /opt/${plugin_name}.tar.gz                                     \
        --strip-components=1                                                  \
        -C user/plugins/${plugin_name}                                      ; \
    done

RUN chown -R www-data:www-data /usr/src/yourls/user/plugins
